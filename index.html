<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test Leaflet TimeDimension</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-timedimension/1.1.0/leaflet.timedimension.control.min.css" />
  <style>html, body, #map { height: 100%; margin: 0; }</style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-timedimension/1.1.0/leaflet.timedimension.min.js"></script>

  <script>
    console.log('L.timeDimension:', L.timeDimension);
    console.log('L.timeDimension.layer:', L.timeDimension.layer);

    var map = L.map('map', {
      center: [46.5, 2.5],
      zoom: 6,
      timeDimension: true,
      timeDimensionOptions: {
        timeInterval: "1993-01-01/2003-12-31",
        period: "P1Y"
      },
      timeDimensionControl: true,
      timeDimensionControlOptions: {
        autoPlay: true,
        loopButton: true,
        timeSliderDragUpdate: true
      }
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // GeoJSON minimal avec propriété popup et datetime dans properties
    var geojsonFeature = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {
            "time": "1993-01-01",
            "popup": "<b>Jan-Rémi FROMENTIN</b><br>Age: 29"
          },
          "geometry": {
            "type": "Point",
            "coordinates": [2.3522, 48.8566] // Paris
          }
        },
        {
          "type": "Feature",
          "properties": {
            "time": "1999-01-01",
            "popup": "<b>Jan-Rémi FROMENTIN</b><br>Age: 36"
          },
          "geometry": {
            "type": "Point",
            "coordinates": [5.7245, 45.1885] // Grenoble
          }
        }
      ]
    };

    var geojsonLayer = L.geoJson(geojsonFeature, {
      onEachFeature: function(feature, layer) {
        if (feature.properties && feature.properties.popup) {
          layer.bindPopup(feature.properties.popup);
        }
      }
    });

    var timedLayer = L.timeDimension.layer.geoJson(geojsonLayer, {
      updateTimeDimension: true,
      updateTimeDimensionMode: 'replace',
      duration: 'P1Y'
    });

    timedLayer.addTo(map);
  </script>
</body>
</html>
